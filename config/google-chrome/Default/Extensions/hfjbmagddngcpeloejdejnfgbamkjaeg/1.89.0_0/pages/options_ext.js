__filename="pages/options_ext.js",define(["./async_bg","./options_base","./options_wnd"],function(n,e,t){"use strict";function o(n){return new Date(+n-6e4*(new Date).getTimezoneOffset()).toJSON().slice(0,-5).replace("T"," ")}function i(e,t){return t&&("omniBlockList"===e||n.Ks.d.Ho([t]))?"$base64:"+btoa(encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,function(n,e){return String.fromCharCode(parseInt(e,16))})):t}function r(n){return n instanceof Array&&(n=n.join("\n").trimRight()),(n=n.replace(/\r\n?/g,"\n").replace(/\xa0/g," ")).replace(/^\$base64:(.*)/gm,function(n,e){try{return decodeURIComponent([].map.call(atob(e),function(n){return"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)}).join(""))}catch(n){}return n})}function s(t,i,s){var u,c,l,a,f,d,m,p,g,w,v,y,h,S,b,C=i.environment,O=C&&C.platform||"",V=C&&parseFloat(C.extension||0)||0,k=V>parseFloat(n.bs.E.kn);if(O&&(O=(""+O).slice(0,10)),confirm(e.qs("confirmImport",[e.qs(true!==s?"backupFile":"recommendedFile"),V>1?e.qs("fileVCVer").replace("*",""+V):"",(V>1?e.qs("fileVCVer_2").replace("*",""+V):"")+(k?e.qs("fileVCNewer"):""),O?e.qs("filePlatform",[e.qs(O)||O[0].toUpperCase()+O.slice(1)]):e.qs("commonPlatform"),t?e.qs("atTime",[o(t)]):e.qs("before")]))){for(f in Object.setPrototypeOf(i,null),null==i.vimSync&&(c=(u=n.bs.rn("vimSync"))&&confirm(e.qs("keepSyncing")),i.vimSync=c||null,u&&console.log("Before importing: You chose to",c?"keep settings synced.":"stop syncing settings.")),l=function(n,e,t,o){var i=arguments.length>3,r=i?o:t,s=["%s %c%s",n,"color:darkred",e];r="string"!=typeof r||r.length<=72?r:r.slice(0,71).trimRight()+"\u2026",i&&s.push(t),s.push(r),console.log.apply(console,s)},t>1e4?console.info("IMPORT settings saved at %c%s%c.","color:darkblue",o(t),"color:auto"):console.info("IMPORT settings:",s?"recommended.":"saved before."),(a=function(n){return n.split(" ").forEach(function(n){return delete i[n]})})("name time environment author description"),i)"@"===f[0]&&delete i[f];for(d=localStorage,m=n.bs.sn,p=e.Ds.Jo,g=d.length;0<=--g;)(f=d.key(g)).includes("|")||f in i||(i[f]=null);for(f in a("findModeRawQuery findModeRawQueryList innerCSS findCSS omniCSS newTabUrl_f hookAccessKeys vomnibarPage_f"),n.bs.Sn)f in i&&(i[n.bs.Sn[f]]=i[f],delete i[f]);for(v in i.vimSync!==n.bs.rn("vimSync")&&(l("import","vimSync",i.vimSync),n.bs.in("vimSync",i.vimSync),p.vimSync.ks()),void 0!==(w=p.keyMappings)&&(delete p.keyMappings,p.keyMappings=w),p)if(h=i[f=(y=p[v]).Ns],delete i[f],null==h?h=m[f]:("string"==typeof m[f]&&(h=r(h)),h=y.Ps(h,"object"==typeof m[f])),y.u(n.bs.rn(f),h)){if(y.Os)continue;y.ks()}else l("import",f,h),n.bs.in(f,h),f in n.bs.un&&e.Ds.us.push(f),y.ks(),y.xs&&y.xs();for(f in i)if(null!=(h=i[f]))"string"==typeof m[f]&&(h=r(h)),f in m?n.bs.rn(f)!==h&&(n.bs.in(f,h),l("update",f,h)):(d.setItem(f,h),l("save",f,h));else{if(f in m){if(h=m[f],n.bs.rn(f)!==h){n.bs.in(f,h),l("reset",f,h);continue}h=n.bs.rn(f)}else h=d.getItem(f);d.removeItem(f),l("remove",f,":=",h)}e.$("#saveOptions").onclick(false),e.$("#advancedOptionsButton").getAttribute("aria-checked")!==""+n.bs.rn("showAdvancedOptions")&&e.$("#advancedOptionsButton").onclick(null,true),console.info("IMPORT settings: finished."),(b=(S=window.VApi&&VApi.y().r)&&S.querySelector("#HCls"))&&(b.click(),e.$("#showCommands").click()),window.VApi&&VApi.t({k:202})}else window.VApi&&VApi.t({k:201})}function u(o,i,r){var u,c,l,a,f,d=null,m=null,p="";try{(u=(function(n){function e(){return/a?/.test("")}function t(n){for(var e=n.length;i.length<e;i+=i);return i.slice(0,e)}var o,i,r,s,u,c,l,a=/[^\r\n]+/g;if(!n||!(n=n.trimRight()))return null;i=" ";try{return u=JSON.parse(n.replace(/"(?:\\[\\\"]|[^"])*"|'(?:\\[\\\']|[^'])*'|\/\/[^\r\n]*|\/\*[^]*?\*\/|#[^\r\n]*/g,function(n){var e=n[0];return"/"===e||"#"===e?n.startsWith("/*")?n.replace(a,t):t(n):n})),e(),u}catch(n){if(o=/\b(?:position (\d+)|line (\d+) column (\d+))/.exec(n+""),e(),!o||!o[0])throw n}return o[2]?(r=+o[2],s=+o[3]):+o[1]>0?(c=n.includes("\r")?n.includes("\r\n")?"\r\n":"\r":"\n",s=(l=n.slice(0,+o[1]).split(c))[(r=l.length)-1].length+1):r=s=1,new SyntaxError(r+":"+s)})(r?i:i.replace(/\xa0/g," ")))instanceof Error?m=u:u?d=u:p=e.qs("notJSON")}catch(n){m=n}return null!=m&&(p=m?(m.message||m)+"":e.qs("exc")+(""!==m?m:e.qs("unknown")),p=(c=/^(\d+):(\d+)$/.exec(p))?e.qs("JSONParseError",[c[1],c[2]]):p),d?(o=+new Date(d.time||("object"==typeof o?+o:o))||0,"Vimium C"!==d.name&&"Vimium++"!==d.name||o<1e4&&o>0?(p=e.qs("notVCJSON"),alert(p)):(l=e.Ds.Jo.keyMappings.$s?null:(t.loadChecker.Ys="",t.loadJS("options_checker.js")),a=o,f=d,void Promise.all([n.Ks.r.pe("KeyMappings"),l]).then(function(){setTimeout(s,17,a,f,r)}))):alert(p)}var c,l,a,f;e.$("#showCommands").onclick=function n(e){var o,i,r;if(window.VApi&&VApi.z){if(i=VApi.y().r,e&&e.preventDefault(),i&&(o=i.querySelector("#HCls"))&&(r=null!=i.querySelector(".HelpCommandName"),t.click(o),r))return;VApi.p({H:12}),e||setTimeout(function(){var n=VApi.y(),e=n.r&&n.r.querySelector("#HDlg");e&&e.querySelector("#HCls").addEventListener("click",function(){location.hash=""},true)},100)}else"undefined"!=typeof VimiumInjector&&setTimeout(n,120,null)},e.Cs.prototype.Su=function(n){var t,o,i,r,s,u,c,l,a;if(!n||!this.mr){for(o=/^([:^]?[a-z\-?*]+:\/\/)?((?:[^\/]|\/])+)(\/[^\]].*|\/?$)/,i=/\\\./g,u=0,c=t=this.gs();u<c.length;u++)(s=o.exec(r=(l=c[u]).pattern.replace("(?:[^./]+\\.)*?","*.")))&&s[1]&&s[2]&&(r=s[3]?s[3].replace(i,"."):"",(s=s[2].replace(i,".").split(".")).reverse(),r=s.join(".")+r),l.oo=r;t.sort(function(n,e){return n.oo<e.oo?-1:n.oo===e.oo?0:1}),this.fs(t),this.ns(),n&&(a=this,this.mr=setTimeout(function(n,e){n.firstChild.data=e,a.mr=0},1e3,n,n.firstChild.data),n.firstChild.data=e.qs("o3_2"))}},e.$("#exclusionSortButton").onclick=function(){e.Ds.Jo.exclusionRules.Su(this)},c="",window.addEventListener("unload",function(){c&&URL.revokeObjectURL(c)}),e.$("#exportButton").onclick=function(e){var r,s,u,l,a,f,d,m,p,g,w,v,y,h,S,b,C;for(c&&(URL.revokeObjectURL(c),c=""),s=!!e&&(e.ctrlKey||e.metaKey||e.shiftKey),u=new Date,(r=Object.create(null)).name="Vimium C",s||(r["@time"]=u.toLocaleString(),r.time=u.getTime()),r.environment={extension:n.bs.E.kn,platform:n.bs.E.On},r.environment.chrome=n.f,l=[],a=localStorage,f=n.bs.sn,d=0,m=a.length;d<m;d++)(p=a.key(d)).includes("|")||p.endsWith("_f")||"findModeRawQueryList"===p||p.endsWith("CSS")||l.push(p);for(l.sort(),g=function(e){var t=a.getItem(e);"string"!=typeof f[e]?r[e]=e in f?n.bs.rn(e):t:t.includes("\n")?(r[e]=t.split("\n")).push(""):r[e]=t,"string"==typeof f[e]&&(r[e]="string"==typeof r[e]?i(e,r[e]):r[e].map(function(n){return i(e,n)}))},w=0,v=l;w<v.length;w++)g(p=v[w]);y=JSON.stringify(r,null,"\t")+"\n",h=o(u),"win"===r.environment.platform&&(y=y.replace(/\n/g,"\r\n")),r=null,S="vimium_c-",S+=s?"settings":h.replace(/[\-:]/g,"").replace(" ","_"),S+=".json",b=new Blob([y],{type:"application/json",endings:"native"}),(C=document.createElement("a")).download=S,C.href=URL.createObjectURL(b),t.click(C),c=C.href,console.info("EXPORT settings to %c%s%c at %c%s%c.","color:darkred",S,"color:auto","color:darkblue",h,"color:auto")},(l=e.$("#settingsFile")).onclick=null,l.onchange=function(){var n,t,o,i=this.files[0];this.value="",i&&(n=e.Ds.Jo.vimSync.Ss?102400:10485760,i.size&&i.size>n?alert(e.qs("JSONTooLarge",[i.name,n/1024])):(t=new FileReader,o=i.lastModified||i.lastModifiedDate||0,t.onload=function(){return u(o,this.result,false)},t.readAsText(i)))},(l=e.$("#importOptions")).onclick=null,l.onchange=function(){e.$("#importButton").focus(),"exported"!==this.value?fetch("../settings-template.json").then(function(n){return n.text()}).then(function(n){return u(0,n,true)}):t.click(e.$("#settingsFile"))},l=null,window.Cu&&(f=window.Cu,delete window.Cu,(a=e.$(f[0])).onclick&&a.onclick(f[1]))});