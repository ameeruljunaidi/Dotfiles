__filename="pages/show.js",define(["./async_bg"],function(n){"use strict";function e(n){(n?addEventListener:removeEventListener)("wheel",t,{passive:false,capture:true})}function t(n){n.ctrlKey&&(n.preventDefault(),n.stopImmediatePropagation(),l(n))}function i(){var n=E.scrollWidth;S.style.height=E.scrollHeight+"px",S.style.width=n+"px",S.style.display=""}function r(n,e){var t,i;if(e.preventDefault(),VData.url){for(i in t=document.createElement("a"),Object.setPrototypeOf(n,null),n)t.setAttribute(i,n[i]);t.href=VData.url,o(t,e)}}function o(n,e){var t=document.createEvent("MouseEvents");return t.initMouseEvent("click",true,true,window,1,0,0,0,0,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,0,null),n.dispatchEvent(t)}function u(n,e){2===e||-2===e?n.rotate(45*e):n.zoom(e/10,true)}function a(n,e){try{n=(e||decodeURIComponent)(n)}catch(n){}return n}function c(n,e){var t=T("#bodyTemplate"),i=document.importNode(t.content.querySelector("#"+n),true);return e||document.body.insertBefore(i,t),i}function l(n){if(n.altKey)return n.stopImmediatePropagation(),r({download:VData.file||""},n);switch(VData.type){case"url":r({target:"_blank"},n);break;case"image":if(VData.error)return;var e=n.ctrlKey||n.metaKey;g().then(function(n){return w(n,e)}).catch(h)}}function f(n){n.preventDefault(),E.onclick&&E.onclick(n)}function s(n,e){n="number"==typeof n?["math","copy","search","ERROR","status","paste","url"][n]:n,T("#textTip").dataset.text=j("t_"+n)||n,T(".colon").dataset.colon=j("colon")+j("NS");var t=T("#textBody");return e?(t.textContent="string"!=typeof e?e.join(" "):e,E.onclick=d):t.classList.add("null"),i()}function d(e){var t,i=getSelection(),r=""+i;if(!r||"image"===VData.type&&r.trim()===E.alt.trim()){if("image"===VData.type&&VData.url){if("Range"===i.type&&!VData.url.startsWith(location.protocol))return;if(e.preventDefault(),(t=navigator.clipboard)&&t.write)return void(null!=M?Promise.resolve(M):fetch(VData.url,{cache:"force-cache",referrer:"no-referrer"}).then(function(n){return n.blob()}).catch(function(){return m(VData.url),0}).then(function(n){return M=n})).then(function(e){var i,r,o;if(e)return i={"image/png":new Blob([e],{type:"image/png"}),"text/html":new Blob,"text/plain":new Blob([VData.url],{type:"text/plain"})},r=function(){return t.write([new ClipboardItem(i)])},n.f<86?r():((o=document.createElement("img")).src=VData.url,VData.file&&o.setAttribute("aria-title",o.alt=VData.file),i["text/html"]=new Blob([o.outerHTML],{type:"text/html"}),r().catch(function(){return delete i["text/html"],r()}))}).catch(function(n){console.log(n),m(VData.url)})}m("url"===VData.type?T("#textBody").textContent:VData.url,e)}}function m(n,e){n&&window.VApi&&(e&&e.preventDefault(),VApi.p({H:16,s:n}))}function h(n){n&&console.log("%o",n)}function g(){return k?Promise.resolve(k):((function(n){if(!T('link[href="'+n+'"]')){var e=document.createElement("link");e.rel="stylesheet",e.href=n,document.head.insertBefore(e,T('link[href$="show.css"]'))}})("../lib/viewer.min.css"),(n="../lib/viewer.min.js",t=n.slice(n.lastIndexOf("/")+1).replace(".js",""),__filename=location.pathname+"?__loader_"+t,new Promise(function(e){define([n],e)})).then(function(n){return n.setDefaults({navbar:false,shown:function(){S.style.display="none"},viewed:function(){z&&(e(false),z(true))},hide:function(){S.style.display="",e(true),z&&z(false)}}),k=n,n}));var n,t}function w(n,e){var t,i=scrollX||scrollY,r=getSelection();return"Range"===r.type&&r.collapseToStart(),(t=C=C||new n(E)).scrollbarWidth=0,t.hiding&&(t.isShown=false),t.isShown||t.show(),t.hiding=false,i&&scrollTo(0,0),t.viewed?(t.zoomTo(1),t):(Object.defineProperty(t,"initialImageData",{configurable:true,enumerable:true,get:function(){return P},set:function(n){var t,i,r,o;P=n,C&&!e&&(e=true,o=(r=1*(t=C.imageData).naturalHeight)-t.height,t.left-=((i=1*t.naturalWidth)-t.width)/2,t.top-=o/2,t.width=i,t.height=r,t.ratio=1)}}),new Promise(function(n,e){z=function(i){z=null,i?n(t):e("failed to view the image")}}))}function p(){F&&(URL.revokeObjectURL(F),F="")}function b(n){var e=n.split(":",1)[0];switch(e.toLowerCase()){case"thunder":case"flashget":case"qqdl":n=n.slice(e.length+3).split("&",1)[0];break;default:return""}try{n=atob(n)}catch(n){return""}return n.startsWith("AA")&&n.endsWith("ZZ")&&(n=n.slice(2,-2)),n.startsWith("[FLASHGET]")&&n.endsWith("[FLASHGET]")&&(n=n.slice(10,-10)),b(n)||n}function v(){console.log("Failed to visit the predicted URL, so go back to the original version."),y(),VData.auto=false,window.onhashchange()}function y(){var n=false;return"once"===VData.auto&&(VData.auto=false,n=true),n&&x(),n}function x(e){var t,i,r=VData.type;r&&(t="#!"+r+" "+(VData.incognito?"incognito=1&":"")+(VData.file?"download="+(function(e){return e.replace(n.f<64||false?/[\x00-`{-\u0390\u03ca-\u4dff\u9fa6-\uffff\s]+/g:new RegExp("[^\\p{L}\\p{N}]+","ug"),encodeURIComponent)})(VData.file)+"&":"")+(VData.auto?"auto="+("once"===VData.auto?"once":1)+"&":"")+(VData.pixel?"pixel=1&":"")+VData.original,VData.full=t,e||(i=_(t,$,true),history.replaceState(i,"","")))}function _(n,e,t){var i,r,o,u;if(-1===e)return n;if(i=[],t)n=encodeURIComponent(n);else try{n=atob(n)}catch(e){n=""}for(r=0,o=n;r<o.length;r++)i.push(o[r].charCodeAt(0));for(u=0;u<i.length;u++)i[u]=255&(i[u]^e>>>8*(3&u));if(n=String.fromCharCode.apply(String,i),t)n=btoa(n);else try{n=decodeURIComponent(n)}catch(e){n=""}return n}function R(n){return VData.full?location.href.split("#",1)[0]+VData.full:n}var k,I,L,VData=null,T=function(n){return document.querySelector(n)},j=chrome.i18n.getMessage,A={},U=document.body,E=null,S=T("#bgLink"),z=null,C=null,P=null,$=+window.name||0,B=/\.(avif|bmp|gif|icon?|jpe?g|a?png|tiff?|webp)(?=[.\-_]|\b)/i,F="",M=null;chrome.i18n.getMessage("lang1")&&(document.title=j("vDisplay")&&"Vimium C "+j("vDisplay")||document.title),window.onhashchange=function(){var t,o,u,d,m,h,g,w,k,T,z,P;for(E&&((function(){if(p(),M=null,I&&(I(),I=null),"image"===VData.type){e(false);var n=document.body.classList;n.remove("pixel"),n.remove("filled"),E.removeAttribute("src"),E.onerror=E.onload=null,C&&(C.destroy(),C=null)}})(),S.style.display="none",E.remove(),E=null),(VData=window.VData=Object.create(null)).o=R,t=location.hash,o="",u="",L||!t&&n.Ks&&n.Ks.l&&n.Ks.l.He.Xe?(t=L||n.Ks.l.He.Xe(),L="",/^[^:]+[ &]data:/i.test(t)&&($=-1),d=_(t,$=$||Math.floor(4294967296*Math.random())||3286711320,true),history.state?history.pushState(d,"",""):history.replaceState(d,"",""),window.name=""+$):t||!history.state||($?(t=_(history.state,$,false),window.name=""+$):history.replaceState(null,"","")),VData.full=t,t.length<3||(t.startsWith("#!image")?(t=t.slice(7),o="image"):t.startsWith("#!url")&&(t=t.slice(5),o="url")),t=t.startsWith("%20")?t.slice(3):t.trim(),m=0;m=t.indexOf("&")+1;t=t.slice(m))if(g=(h=t.slice(0,m).indexOf("="))>0?t.slice(0,h):"",w=h>0?t.slice(h+1,m-1):"","download"===g)u=(u=a(w).split(/\||\uff5c| [-\xb7] /,1)[0].trim()).replace(/[\r\n"]/g,""),VData.file=u;else if(w=w.toLowerCase(),"auto"===g)VData.auto="once"===w?w:"true"===w||"false"!==w&&parseInt(w,10)>0;else if("pixel"===g)VData.pixel="1"===w||"true"===w;else{if("incognito"!==g)break;VData.incognito="true"===w||"false"!==w&&parseInt(w,10)>0}switch((t=a(t,t.includes(":")||t.includes("/")?decodeURI:null).trim())?t.toLowerCase().startsWith("javascript:")?o=t=u=VData.file="":n.Ks?(k=n.Ks.r.K(t,null,-2),n.Ks.r.V<=2&&(t=k)):t.startsWith("//")?t="http:"+t:/^([-.\dA-Za-z]+|\[[\dA-Fa-f:]+])(:\d{2,5})?\//.test(t)&&(t="http://"+t):"image"===o&&(o=""),VData.type=o,/^data:/i.test(t)&&(t="data:"+t.slice(5)),VData.url=VData.original=t,o){case"image":VData.auto&&(T=(function(e){function t(n){try{return new URL(n)}catch(n){}return null}function i(n){try{n=decodeURIComponent(n||"")}catch(n){}return n}var r,o,u,a,c,l,f,s,d,m,h,g,w,p,b,v,y,x,_=e;if(!(r=t(e=n.Ks&&n.Ks.r.we(e,256)||e))||!/^(ht|s?f)tp/i.test(r.protocol))return null;if(o=r.origin,u=r.pathname,(a=r.search).length>10)for(c=0,l=a.slice(1).split("&");c<l.length;c++){if(s=(f=l[c]).split("=",1)[0],(m=d=f.slice(s.length+1)).length>7)if(!m.includes("://")&&/%(?:3[aA]|2[fF])/.test(m)&&(m=i(m).trim()),m.includes("/")&&null!=t(m)){if(/^(?:imgurl|mediaurl|objurl|origin(?:al)?|real\w*|src|url)$/i.test(s))return m;if(h=m.split("?")[0].split("/"),B.test(h[h.length-1])&&!/\bthumb/i.test(s))return m}else if("id"===s&&/&w=\d{2,4}&h=\d{2,4}/.test(a))return o+u+"?id="+d;if("name"===s&&/^(\d{2,4}x\d{2,4}|small)$/i.test(d)&&a.toLowerCase().includes("format="))return o+u+a.replace(m,"large")}if(g=null,(g=/[?&]s=\d{2,4}(&|$)/.exec(a))&&a.split("=").length<=3)return o+u;if(w=(a=u).lastIndexOf("/")+1,v=null,b=(p=(a=a.slice(w)).lastIndexOf("@")+1||a.lastIndexOf("!")+1)>2||B.test(a)){for(w+=p,a=a.slice(p),y=/(?:[.\-_]|\b)(?:[1-9]\d{2,3}[a-z]{1,3}[_\-]?|[1-9]\d?[a-z][_\-]?|0[a-z][_\-]?|[1-9]\d{1,3}[_\-]|[1-9]\d{1,2}(?=[.\-_]|\b)){2,6}(?=[.\-_]|\b)/gi;v=y.exec(a);g=v);g&&/.[_\-].|\d\dx\d/i.test(g[0])?(v=B.exec(a.slice(g.index+g[0].length)),x=g[0].length,v&&0===v.index&&(x+=v[0].length),a=u.slice((w+=g.index)+x),/[@!]$/.test(a||u.charAt(w-1))?a?a=a.slice(0,-1):w--:a||!v||0!==v.index||B.test(u.slice(Math.max(0,w-6),w))||(a=v[0])):(g=/\b([\da-f]{8,48})([_-][a-z]{1,2})\.[a-z]{2,4}$/.exec(a))?(w+=g.index+g[1].length,a=a.slice(g.index+g[1].length+g[2].length)):b=false}return b||p>2?b=b||0:(g=/_(0x)?[1-9]\d{2,3}(x0)?\./.exec(a))?a=a.slice(0,g.index)+a.slice(g.index+g[0].length-1):a.startsWith("thumb_")?a=a.slice(6):/^[1-9]\d+$/.test(a)&&+a>0&&+a<640?(w--,a=""):B.test(a)&&/^\/(small|(thumb|mw|orj)[1-9]\d{2,3})\//.test(u)?(b=true,a="/large"+u.slice(u.indexOf("/",1)),w=0):b=0,0!==b?o+u.slice(0,w)+a:_!==e?e:null})(t))&&(console.log("Auto predict a better URL:\n %o =>\n %o",t,T),t=VData.url=T),(E=c("shownImage")).onerror=function(){VData.url!==VData.original&&VData.url?v():(y(),VData.auto=false,this.onerror=this.onload=null,this.alt=VData.error=j("failInLoading"),n.f>=60&&this.classList.add("broken"),setTimeout(i,34),this.onclick=function(e){n.Ks&&n.Ks.a._t(VData.url)||(e.ctrlKey||e.shiftKey||e.altKey||!chrome.tabs||!chrome.tabs.update?r({target:"_top"},e):chrome.tabs.update({url:VData.url}))})},/[:.]/.test(t)?(E.onclick=l,E.onload=function(){var n,e,t,r,o,u,a,l,f=this.naturalWidth,s=this.naturalHeight;if(f<12&&s<12){if(VData.auto)return void v();if(f<2&&s<2)return console.log("The image is too small to see."),void this.onerror(null)}if(VData.original=VData.url,y(),((e=(n=VData.url.slice(0,6).toLowerCase()).startsWith("blob:"))||n.startsWith("data:")&&!this.src.startsWith("data"))&&(S.dataset.vimUrl=VData.original=VData.url=this.src,x(e?0:1)),this.onerror=this.onload=null,this.src.startsWith("blob:")||setTimeout(function(){E.src=E.src},0),i(),this.classList.add("zoom-in"),VData.pixel){for(U.classList.add("pixel"),devicePixelRatio,(t=c("snapshot-banner",true)).querySelector(".banner-close").onclick=function(){t.remove()},r=t.querySelectorAll("[data-i]"),o=0;o<r.length;o++)a=(u=r[o].dataset.i).endsWith("-t"),(l=j(a?u.slice(0,-2):u))&&(a?r[o].title=l:r[o].textContent=l);U.insertBefore(t,U.firstChild)}f>=.9*innerWidth&&U.classList.add("filled")},(function(e,t){var i,r,o,u,a=new Text,c=document.body,l=I=function(){t.removeEventListener("load",l),t.removeEventListener("error",l),clearTimeout(u),a.remove(),I===l&&(I=null)};t.addEventListener("load",l,true),t.addEventListener("error",l,true),r=(i=e.slice(0,20).toLowerCase()).startsWith("blob:"),o=i.startsWith("data:"),r||o&&!(e.length<1e4)||(VData.incognito||n.Ks.l.rn("showInIncognito"))&&/^(ht|s?f)tp|^data:/.test(i)&&"cache"in Request.prototype?(p(),c.replaceChild(a,t),Promise.resolve(A[e]||(n.f<48?new Promise(function(n,t){var i=new XMLHttpRequest;i.responseType="blob",i.onload=function(){n(this.response)},i.onerror=function(n){t("Error: "+n.message)},i.open("GET",e,true),i.send()}):fetch(e,r||o?{}:{cache:"no-store",referrer:"no-referrer"}).then(function(n){return n.blob()}))).then(function(n){return A[e]=n,F=URL.createObjectURL(M=n)},function(){return e}).then(function(n){t.src=n,a.parentNode?c.replaceChild(t,a):c.appendChild(t)})):t.src=e,u=setTimeout(function(){!t.parentNode||t.scrollHeight>=24||t.scrollWidth>=80?l():a.parentNode||(c.insertBefore(a,t),a.data=j("loading"))},400)})(t,E)):(t=VData.url="",E.onerror(null),E.alt=VData.error=j("none")),u&&(VData.file=u=(function(n){var e,t,i,r;if(n&&!/.\.[a-z]{3,4}\b/i.test(n)){if(e=B.exec(VData.url))return n+e[0];if((t=M?M.type.toLowerCase():"").startsWith("image/"))for(r in i={jpeg:"jpg",png:0,bmp:0,svg:0,gif:0,tif:0,ico:0})if(i.hasOwnProperty(r)&&t.includes(r))return i[r]||"."+r}})(u)||u,(z=u.split(/[/\\]+/)).length>1&&E.setAttribute("download",z[z.length-1]),E.alt=u,E.setAttribute("aria-title",u)),e(true);break;case"url":if(E=c("shownText"),t&&n.Ks){if(P=null,t.startsWith("vimium://")&&(P=n.Ks.r.J(t.slice(9),1,true)),"string"==typeof(P=null!==P?P:n.Ks.r.K(t,null,-1)))P=n.Ks.r.oe(P),P=n.Ks.r.Re(P);else{if(P instanceof n.Ks.Promise){P.then(function(n){s(n[1],n[0]||n[2]||"")});break}if(P instanceof n.Ks.Array){s(P[1],P[0]);break}}t=P}"string"==typeof t&&(t=b(t)||t),s(o,t);break;default:t="",(E=c("shownImage")).src="../icons/icon128.png",S.style.display="none",e(true)}S.dataset.vimUrl=t,u?(S.dataset.vimText=u,S.download=u):(S.removeAttribute("data-vim-text"),S.removeAttribute("download")),S.onclick=E?f:l},window.onhashchange(),window.onpopstate=function(){window.onhashchange()},window.onunload=p,U.ondrop=function(n){var e,t,i=n.dataTransfer.files;1===i.length&&(t=(e=i.item(0)).name,(e.type.startsWith("image/")||B.test(t))&&(n.preventDefault(),L="#!image download="+t+"&"+URL.createObjectURL(e),onhashchange()))},U.ondragover=U.ondragenter=function(n){var e=n.dataTransfer.items;1===e.length&&e[0].type.startsWith("image/")&&n.preventDefault()},document.addEventListener("keydown",function(n){if(("image"!==VData.type||!(function(n){var e,t,i,r,a,c,l;if(VData.error)return false;if(e=n.keyCode,"space"===(i=(t=window.VApi&&VApi.z?VApi.m({c:" ",e:n,i:e},8):32===e?"space":13===e?"enter":"").slice(t.lastIndexOf("-")+1)||t&&"-")||"enter"===i)return VData.pixel&&(a=(r=document.activeElement)&&document.querySelector("#snapshot-banner"))&&a.contains(r)?((c=a.querySelector(".banner-close")).contains(r)&&c.onclick(null),true):(n.preventDefault(),"enter"===i&&C&&C.isShown&&!C.hiding&&!C.played?C.play(true):C&&C.isShown&&!C.hiding||o(E,n),true);switch(l=0,t){case"c-=":case"m-=":case"+":case"=":case"up":l=1;break;case"left":l=-2;break;case"right":l=2;break;case"c--":case"m--":case"-":case"down":l=-1;break;default:return false}return n.preventDefault(),n.stopImmediatePropagation(),C&&C.viewed?u(C,l):g().then(w).then(function(n){u(n,l)}).catch(h),true})(n))&&(n.ctrlKey||n.metaKey)&&!n.altKey&&!n.shiftKey&&!n.repeat){var e=String.fromCharCode(n.keyCode);if("S"===e)return r({download:VData.file||""},n);if("C"!==e)return"A"===e?(function(n){"image"===VData.type&&(VData.error||C&&C.isShown&&!C.hiding?n.preventDefault():E.classList.toggle("invert"))})(n):void 0;d(n)}})});