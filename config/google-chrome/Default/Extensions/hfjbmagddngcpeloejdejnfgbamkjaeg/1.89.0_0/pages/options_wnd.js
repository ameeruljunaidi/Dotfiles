__filename="pages/options_wnd.js",define(["exports","./async_bg","./options_base","./options_defs"],function(n,e,o,t){"use strict";function i(){function n(){var n,t,i,r,u=o.Ds.Jo;for(n in u)"object"==typeof(i=(t=u[n]).Ss)&&i&&(t.Ss=e.bs.rn(t.Ns));r=false,(u.exclusionRules.gr.length||u.keyMappings.$s)&&(r=true),r&&!e.Ks.KeyMappings&&e.Ks.r.pe("KeyMappings"),e.Ks.r.De(1)}e.Ks.removeEventListener("unload",i),setTimeout(function(){if(e.Tu(),!e.Ks)return window.onbeforeunload=null,void window.close();e.Ks.addEventListener("unload",i),"loading"===e.Ks.document.readyState?e.Ks.addEventListener("DOMContentLoaded",function o(){e.Ks.removeEventListener("DOMContentLoaded",o,true),setTimeout(n,100)},true):setTimeout(n,67)},200)}var r,u,s,a,c,f,d,l,m,h,p=/\sEdg\//.test(navigator.appVersion);o.Es&&o.Bs(o.Es),o.Bs(function(n){var o=document.documentElement.classList,t=function(){removeEventListener("DOMContentLoaded",t),e.bs.en.d&&o.add("auto-dark"),e.bs.en.m&&o.add("less-motion")};addEventListener("DOMContentLoaded",t),n.textContent=e.bs.E.En},o.$(".version")),t.saveBtn.onclick=function(n){if(false===n||o.Ds.tu()){var i=o.Ds.us;o.Ds.us=[],this.disabled=true,this.firstChild.data=o.qs("o115_3"),t.exportBtn.disabled=false,t.savedStatus(false),window.onbeforeunload=null,0!==i.length&&setTimeout(function(n){e.bs.fn({N:6,d:n.map(function(n){return e.bs.un[n]})})},100,i)}},r=function(){var n,i,r,u,s,a=false,c=o.$("#advancedOptionsButton");for(c.onclick=function(n,t){var i,r=this;null==t||"hash"===t&&false===e.bs.rn("showAdvancedOptions")?e.bs.in("showAdvancedOptions",a=!a):a=e.bs.rn("showAdvancedOptions"),i=o.$("#advancedOptions"),o.Bs(function(){i.previousElementSibling.style.display=i.style.display=a?"":"none";var n=a?"Hide":"Show";r.firstChild.data=o.qs(n)||n,r.setAttribute("aria-checked",""+a)},9)},c.onclick(null,true),o.Bs(function(){var n,e;for(n in o.Ds.zs=false,o.Ds.Jo)(e=o.Ds.Jo[n]).fs(e.Ss)}),o.Ds.Jo.exclusionRules.Ss.length>0&&o.Bs(function(n){n.style.visibility=""},o.$("#exclusionToolbar")),i=(n=o.$$("[data-check]")).length;0<=--i;)(c=n[i]).addEventListener(c.dataset.check||"input",d);for(document.addEventListener("keyup",function(n){var e=n.target,o=n.keyCode;if(13===o){if(e instanceof HTMLAnchorElement)e.hasAttribute("href")||setTimeout(function(n){m(n),n.blur()},0,e);else if((n.ctrlKey||n.metaKey)&&(e.blur&&e.blur(),t.savedStatus()))return t.saveBtn.onclick()}else{if(32!==o)return;e instanceof HTMLSpanElement&&e.parentElement instanceof HTMLLabelElement&&(n.preventDefault(),m(e.parentElement.control))}}),r=function(){var n,e,t=o.$("#"+this.dataset.autoResize),i=t.scrollHeight,r=t.scrollWidth,u=r-t.clientWidth;i<=t.clientHeight&&u<=0||(n=Math.max(Math.min(innerWidth,1024)-120,550),t.style.maxWidth=r>n?n+"px":"",t.style.height=t.style.width="",e=t.offsetHeight-t.clientHeight,i+=e=(u=r-t.clientWidth)>0?Math.max(26,e):e+18,u>0&&(t.style.width=t.offsetWidth+u+4+"px"),t.style.height=i+"px")},i=(n=o.$$("[data-auto-resize]")).length;0<=--i;)n[i].onclick=r;for(r=function(n){var e=this.dataset.delay,o=null;"continue"!==e&&n&&n.preventDefault(),"event"===e&&(o=n||null),window.Cu=["#"+this.id,o],"complete"!==document.readyState?window.addEventListener("load",function n(e){e.target===document&&(window.removeEventListener("load",n),f("options_ext.js"))}):f("options_ext.js")},i=(n=o.$$("[data-delay]")).length;0<=--i;)n[i].onclick=r;if(e.f<53)for(r=function(n){n.target===this&&(n.preventDefault(),getSelection().selectAllChildren(this))},i=(n=o.$$(".sel-all")).length;0<=--i;)n[i].onmousedown=r;for((n=o.$$("[data-permission]")).length>0&&(function(n){function t(){var n,e=this.querySelector("[data-permission]");this.onclick=null,e&&(e.placeholder=o.qs("lackPermission",[(n=e.dataset.permission)?': "'+n+'"':""]))}var i,r,u,s,a=chrome.runtime.getManifest();for(i=0,r=a.permissions||[];i<r.length;i++)a[r[i]]=true;for(u=function(i){var r=n[i],u=r.dataset.permission;if("C"===u[0]){if(e.f>=+u.slice(1))return"continue";u=o.qs("beforeChromium",[u.slice(1)])}else{if(u in a)return"continue";u=o.qs("lackPermission",[u?":\n* "+u:""])}u=o.qs("invalidOption",[u]),o.Bs(function(n){n.disabled=true,n instanceof HTMLInputElement&&"checkbox"===n.type?(n.nextElementSibling.tabIndex=-1,(n=n.parentElement).title=u):(n.value="",n.title=u,n.parentElement.onclick=t)},r)},s=n.length;0<=--s;)u(s)})(n),0===e.Ks.l.E.Dn.length&&o.Bs(function(n){for(var e=n.length;0<=--e;)n[e].remove()},o.$$(".require-shortcuts")),setTimeout(function(){var n,t,i,r=o.$$("[data-href]");for(n=r.length;0<=--n;)i=e.Ks.r.K((t=r[n]).dataset.href,null,-1),t.removeAttribute("data-href"),t.setAttribute("href",i)},100),c=o.$("#openExtensionsPage"),e.f<65&&(c.href="chrome://extensions/configureCommands"),c.onclick=function(n){n.preventDefault(),e.Ks.a.rt[19]({u:this.href,r:1,p:true})},o.Bs(function(n){var e=n.children[1],t=o.qs("NewTabAdapter");e.title=t+" - "+o.qs("webstore")},o.$("#chromeExtVomnibar")),n=o.$$(".ref-text"),u=function(n){a||o.$("#advancedOptionsButton").onclick(null),n.preventDefault();var t=o.Ds.Jo[this.getAttribute("for")].$t.nextElementSibling;e.f<61?t.scrollIntoViewIfNeeded():t.scrollIntoView({block:"center"}),t.focus(),window.VApi&&VApi.x(t.parentElement.parentElement)},s=function(e){var t=o.Ds.Jo[n[e].getAttribute("for")],i=t.xs;t.xs=function(){i.call(t),o.Bs(function(n){n.textContent=o.qs(t.gs()>1?"o145_2":"o144")},o.$("#"+t.$t.id+"Status"))},n[e].onclick=u,t.$t.addEventListener("change",t.xs,true)},i=n.length;0<=--i;)s(i)},u=function(){var n,t,i,s;for(n in r(),r=u=null,o.Ds.Jo)o.Ds.Jo[n].xs();(t=o.Ds.Jo.newTabUrl).$s.ws(t.Ss),e.bs.en.o||o.Bs(function(n){n.textContent="Cmd"},o.$("#Ctrl")),window.onhashchange(),e.f>75&&((i=matchMedia("(prefers-color-scheme: dark)")).onchange=function(){e.bs._n(),s(),setTimeout(s,34)},s=function(){var n,t,r,u=o.Ds.Jo.autoDarkMode;u.Ss&&u.Os&&window.VApi&&VApi.z&&(n=i.matches,r=(t=VApi.y().r)&&t.querySelector(".HUD:not(.UI)"),e.bs.mn("d",n,VApi.z),r&&r.classList.toggle("D",n))},setTimeout(s,800))},s=chrome.permissions,a=chrome.runtime.getManifest().optional_permissions||[],s&&a.length?(c=["downloads"],!p||c.push("chrome://new-tab-page/"),a=a.filter(function(n){return!c.some(function(e){return"string"==typeof e?n===e:e.test(n)})}),Promise.all(a.map(function(n){return new Promise(function(e){s.contains(n.includes(":")?{origins:[n]}:{permissions:"downloads.shelf"===n?["downloads",n]:[n]},function(n){return e(n||false),chrome.runtime.lastError})})})).then(function(n){var i,r,u,c,f,d,l,m,h,p=document.createDocumentFragment(),w={"chrome://new-tab-page/":"opt_cNewtab","downloads.shelf":"opt_closeShelf"},v=o.$("#optionalPermissionsTemplate"),g=v.content.firstElementChild,b=[];for(i=0;i<a.length;i++)u=(r=document.importNode(g,true)).querySelector("input"),d=w[c=a[i]],u.checked=f=n[i],u.value=c,l=o.qs(d||"opt_"+c)||c,m=c.startsWith("chrome:")?o.qs("optOfChromeUrl"):"","chrome://new-tab-page/"===c&&e.f<85&&(m=o.qs("requireChromium",[85]),u.disabled=true,u.checked=false,r.title=o.qs("invalidOption",[o.qs("beforeChromium",[85])])),r.lastElementChild.textContent=l+m,1===a.length&&r.classList.add("single"),p.appendChild(r),b.push({qe:c,Ss:f,$t:u});(h=v.parentElement).appendChild(p),h.dataset.model="OptionalPermissions",t.registerClass("OptionalPermissions",(function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return __extends(e,n),e.prototype.vr=function(){this.$t.onchange=this.ns},e.prototype.gs=function(){return b.map(function(n){return n.$t.checked?"1":"0"}).join("")},e.prototype.ks=function(){this.Os=true,this.Ss=b.map(function(n){return n.Ss?"1":"0"}).join(""),this.fs(this.Ss)},e.prototype.fs=function(n){for(var e=0;e<b.length;e++)b[e].$t.checked="1"===n[e]},e.prototype.Ts=function(){return false},e.prototype.As=function(n){var e,t=this,i=[],r=[],u={};return b.forEach(function(n){var e=n.$t.checked;n.Ss!==e&&(n.Ss=e,e?("downloads.shelf"===n.qe&&i.push("downloads"),(n.qe.includes(":")?r:i).push(n.qe),u[n.qe]=n):s.remove(n.qe.includes(":")?{origins:[n.qe]}:{permissions:"downloads.shelf"===n.qe?["downloads",n.qe]:[n.qe]},function(e){var o=chrome.runtime.lastError;return(o||!e)&&console.log("Can not remove the permission %o :",n.qe,o&&o.message||o),o}))}),e=function(n,e){var i,r,s,a,c,f=chrome.runtime.lastError;if((f||!e)&&console.log("Can not request permissions of %o :",n,f&&f.message||f),!e){for(i=0,r=n;i<r.length;i++)(s=u[r[i]])&&(s.Ss=false,f&&((c=(a=s.$t.parentElement).nextElementSibling)&&c.classList.contains("tip")||((c=document.createElement("div")).className="tip",a.parentElement.insertBefore(c,a.nextElementSibling)),c.textContent=a.title=o.qs("exc")+(f&&f.message||JSON.stringify(f)),a.lastElementChild.classList.add("has-error")));t.ks()}return f},i.length&&s.request({permissions:i},e.bind(0,i)),r.length&&s.request({origins:r},e.bind(0,r)),n},e})(o.Ds)),t.createNewOption(h)})):o.$("#optionalPermissionsBox").style.display="none",o.$("#userDefinedCss").addEventListener("input",o.Zs(function(){var n,t,i,r,u,s,a,c=o.Ds.Jo.userDefinedCss,f=c.$t.classList.contains("debugging");(!c.Os||f)&&window.VApi&&VApi.z&&(t=(n=c.gs())===c.Ss,i=e.bs.yn(-1,n),r=VApi.y().r,!f&&e.Ks&&chrome.tabs.query({currentWindow:true,active:true},function(n){if(n&&n[0]&&n[0].url===location.href){var o=e.Ks.a.dn(n[0].id,0);o&&(o.s.f|=36)}}),c.$t.classList.toggle("debugging",!t),VApi.t({k:r||t?0:1,t:"Debugging CSS\u2026",H:i.ui,f:i.find}),(s=(u=r&&r.querySelector("iframe.Omnibar"))&&u.contentDocument)&&((a=s.querySelector("style.debugged")||s.querySelector("style#custom"))||((a=s.createElement("style")).type="text/css",a.id="custom"),a.parentNode||s.head.appendChild(a),a.classList.add("debugged"),a.textContent=(t?"\n":"\n.transparent { opacity: 1; }\n")+(i.omni&&i.omni+"\n"||"")))},1200,o.$("#userDefinedCss"),0)),o.$("#importButton").onclick=function(){var n=o.$("#importOptions");n.onchange?n.onchange(null):m(o.$("#settingsFile"))},o.Bs(function(n){var t,i=e.bs.E.On;n.textContent=(p?["MS Edge"]:/\bChromium\b/.exec(navigator.appVersion)||["Chrome"])[0]+" "+e.f+o.qs("comma")+o.qs("NS")+(o.qs(i)||i[0].toUpperCase()+i.slice(1)),p&&((t=o.$("#openExtensionsPage")).textContent=t.href="edge://extensions/shortcuts")},o.$("#browserName")),f=function(n){var e=n.slice(n.lastIndexOf("/")+1).replace(".js","");return __filename="__loader_"+e,new Promise(function(e){define([n],function(){return e()})})},d=function(){null==d.Ys&&(d.Ys=this.id,f("options_checker.js"))},document.addEventListener("keydown",function(n){var e,t,i,r,u;if(32===n.keyCode)"span"===(u=n.target).localName&&"label"===u.parentElement.localName&&n.preventDefault();else{if(!window.VApi||!VApi.z||"input textarea".includes(document.activeElement.localName))return;"a-f12"===(e=VApi.m({c:" ",e:n,i:n.keyCode},9))?(t=o.$("#importOptions"),i=t.selectedIndex,r=function(){t.onchange&&t.onchange(null),t.selectedIndex=i},o.$("#recommendedSettings").selected=true,null!=t.onchange?r():setTimeout(r,100)&&t.click()):"?"===e&&o.$("#showCommands").click()}}),window.onhashchange=function(){var n,e=location.hash;(e=e.slice("!"===e[1]?2:1))&&/^[a-z][a-z\d_-]*$/i.test(e)&&((n=o.$('[data-hash="'+e+'"]'))?n.onclick&&o.Bs(function(){n.onclick(null,"hash")}):(n=o.$("#"+e))&&o.Bs(function(){n.dataset.model&&n.classList.add("highlight");var e=function(e){e&&e.target!==window||(window.onload&&(window.onload=null,window.scrollTo(0,0)),n.scrollIntoViewIfNeeded())};if("complete"===document.readyState)return e();window.scrollTo(0,0),window.onload=e}))},e.bs.zn&&e.bs.zn()?e.bs.zn().then(u):u(),window.onunload=function(){e.Ks.removeEventListener("unload",i),e.Ks.r.De(-1)},e.Ks.r.De(1),e.Ks.addEventListener("unload",i),(l=e.Ks.c.zt.get("?"))&&7===l.Dt||(h="",e.Ks.c.zt.forEach(function(n,e){7===n.Dt&&(h=h&&h.length<e.length?h:e)}),h&&o.Bs(function(n){return n.textContent=h},o.$("#questionShortcut"))),document.addEventListener("click",function n(){var o=window.VApi,t=o&&o.y();t&&t.r&&(document.removeEventListener("click",n,true),t.r.addEventListener("click",function(n){var e,o=n.target;VApi&&o.classList.contains("HelpCommandName")&&(e=o.textContent.slice(1,-1),VApi.p({H:16,s:e}))},true),document.addEventListener("click",function(n){var o,t,i,r,u;"a"===n.target.localName&&(n.ctrlKey||n.metaKey)&&(i=(t=(o=window.VApi)&&o.b)&&t.$())&&i.b&&!i.a&&(r=-17&i.m)<32&&2&r&&!(1&r)&&(u=e.Ks.a.mt())>=0&&setTimeout(function(){chrome.tabs.update(u,{active:true})},0)}))},true),n.click=m=function(n){var e=document.createEvent("MouseEvents");return e.initMouseEvent("click",true,true,window,1,0,0,0,0,false,false,false,false,0,null),n.dispatchEvent(e)},n.loadChecker=d,n.loadJS=f,Object.defineProperty(n,"Fs",{value:true})});